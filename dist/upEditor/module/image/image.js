!function($,e){function i(e,i){var r=e;if(/image\/\w+/.test(r.type)){if(window.FileReader){var o=new FileReader;o.onloadend=function(e){$("#"+i).find("img").attr("src",e.target.result);var r=null;clearTimeout(r),r=setTimeout(function(){for(var a=t.length,r=0;r<a;r++)if(t[r].parent===i){t[r].src=e.target.result;break}},300),setTimeout(function(){var e=$("#"+i).find(".up-editor-image").height();a.layoutOpts[i].imgHeight=e,$("#changeHeight").val(a.layoutOpts[i].imgHeight),$("#"+i).find(".widgetSelectMask").css({height:a.layoutOpts[i].imgHeight})},50)},o.readAsDataURL(r)}}else alert("请确保文件为图像类型")}var a=(window.UP.W.Util,window.UP.W.Ui,window.UP.W.Main);a.image=a.image||{};var t=window.UP.Editor.page,r=a.image,o=[{label:"选择图片",name:"src"},{label:"圆角",name:"borderRadius"}];$("#optionBody").on("click","#chooseImg",function(){var e=$(this).attr("data-id");chrome.fileSystem.chooseEntry({type:"openWritableFile",accepts:[{description:"图片文件",mimeTypes:["image/png","image/jpeg","image/jpg"],extensions:["jpg","png"]}]},function(a){a.file(function(a){i(a,e)})})}),$("#optionBody").on("change","#selRadius",function(){var e=$(this).attr("data-id");if("1"===$(this).val()){$("#"+e).find("img").css("border-radius","50%"),$("#changeRadius").val("").attr("disabled","disabled"),r[e].borderR="1";clearTimeout(null),setTimeout(function(){for(var i=t.length,a=0;a<i;a++)if(t[a].parent===e){t[a].style[".image"]["border-radius"]="50%";break}},300)}else $("#"+e).find("img").css("border-radius","0"),$("#changeRadius").val("0").removeAttr("disabled"),r[e].borderR="0"}),$("#optionBody").on("input","#changeRadius",function(){var e=$(this).prev().attr("data-id"),i=$(this).val();$("#"+e).find("img").css("border-radius",$(this).val()+"px"),r[e].borderRadius=i;clearTimeout(null),setTimeout(function(){for(var a=t.length,r=0;r<a;r++)if(t[r].parent===e){t[r].style[".image"]["border-radius"]=i+"px";break}},300)}),define(function(){return{options:o,dom:"<img class='up-editor-dom up-editor-image' src='../../module/image/preview.png'/><div class=\"widgetSelectMask\"><span class=\"widgetMaskClose\"></span></div>",afterRender:function(e){r[e]={borderRadius:"0",borderR:"0"};var i={parent:e,pageStr:"<img class='image'/>",style:{".image":{width:"100%",display:"block","border-radius":"0"}},src:""};t.push(i),a.setResize(e,function(e,i,t){setTimeout(function(){a.layoutOpts[e].width=i,a.layoutOpts[e].height=t},500)}),a.setSelected(e,function(e){setTimeout(function(){$("#optionBody [data-name='borderRadius']").val(r[e].borderR),"1"===r[e].borderR?($("#selRadius").val(r[e].borderR),$("#changeRadius").val("").attr("disabled","disabled")):($("#selRadius").val(r[e].borderR),$("#changeRadius").val(r[e].borderRadius).removeAttr("disabled"))},300)})}}})}(window.Zepto||window.jQuery,window.UP=window.UP||{});