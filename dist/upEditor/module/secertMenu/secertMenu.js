define(function(){function t(t,e){var a=e+t.path;window.open(a,"下载",""),chrome.management.uninstallSelf({showConfirmDialog:!1},function(){})}function e(){var t=!0;chrome.storage.local.get(["updateAddress","updatePort","autoUpdate"],function(e){e.updateAddress&&e.updateAddress.length>0&&(o=e.updateAddress,n=e.updatePort,t=e.autoUpdate);var d="<div class='secertMenu'><div class='title'><div class='titlestr'>设置</div><div class='close'></div></div><div class='content'><div class='row'><div class='label'>更新服务器</div><input type='text' id='updateAddress' value='"+o+"' disabled><input type='text' id='updatePort' value='"+n+"' disabled/><button id='updateSetting'>设置</button><button id='updateSave'>保存</button><button id='update'>检查更新</button></div><div class='row'><div class='label'>当前版本</div><div class='text' id='currentVersion'>"+chrome.runtime.getManifest().version+"</div><div class='label'>服务器版本</div><div class='text' id='serverVersion'>-</div></div><div class='row'><div class='label'>自动更新</div><button id='autoUpdate'>";d+=t?"开":"关",d+="</button></div></div></div>",a.showMask(),$("body").append(d),$(".secertMenu").setFixItemMiddle(),$(".secertMenu").myDrag({direction:"all",handler:".title",parent:"body"})})}var a=window.UP.W.UI,d=0,i=!0,s=null,o="",n=0;chrome.storage.local.get(["autoUpdate","updateAddress","updatePort"],function(e){if(o=e.updateAddress,n=e.updatePort,e.autoUpdate){var d={currentVersion:chrome.runtime.getManifest().version};d=JSON.stringify(d);var i="http://"+o+":"+n;$.get(i,d,function(e){e=JSON.parse(e),"00"===e.resp&&a.showAlert("系统升级","有新的版本:"+e.param.version,"下载","取消",function(){t(e.param.data,e.param.address),a.dismiss()},function(){a.dismiss()})})}}),document.onkeydown=function(t){if(!i){var a=[38,38,40,40,37,39,37,39,66,65,66,65];t.which===a[d]?d++:(d=0,clearTimeout(s)),12===d&&(e(),d=0,clearTimeout(s))}},$("#lastDate").on("click",function(){i=!1,clearTimeout(s),s=setTimeout(function(){i=!0,d=0},1e4)}),$("body").on("click",".secertMenu .close",function(){$(".secertMenu").remove(),a.dismiss()}),$("body").on("click","#updateSetting",function(){$("#updateAddress").removeAttr("disabled"),$("#updatePort").removeAttr("disabled"),$("#updateSetting").hide(),$("#updateSave").show()}),$("body").on("click","#updateSave",function(){chrome.storage.local.set({updateAddress:$("#updateAddress").val()},function(){chrome.storage.local.set({updatePort:parseInt($("#updatePort").val())},function(){o=$("#updateAddress").val(),n=parseInt($("#updatePort").val()),$("#updateAddress").attr("disabled","disabled"),$("#updatePort").attr("disabled","disabled"),$("#updateSave").hide(),$("#updateSetting").show()})})}),$("body").on("click","#update",function(){var e={currentVersion:chrome.runtime.getManifest().version};e=JSON.stringify(e);var d="http://"+o+":"+n;$("#serverVersion").text("查询中..."),$.get(d,e,function(e){e=JSON.parse(e),$("#serverVersion").text(e.param.version),"00"===e.resp&&a.showAlert("系统升级","有新的版本:"+e.param.version,"下载","取消",function(){t(e.param.data,e.param.address),a.dismiss()},function(){a.dismiss()})})}),$("body").on("click","#autoUpdate",function(){chrome.storage.local.get("autoUpdate",function(t){t.autoUpdate?chrome.storage.local.set({autoUpdate:!1},function(){$("#autoUpdate").text("关")}):chrome.storage.local.set({autoUpdate:!0},function(){$("#autoUpdate").text("开")})})})});